<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker Link Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map { height: 400px; }
        .link-box {
            background-color: #f3f4f6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .copy-btn {
            transition: all 0.3s ease;
        }
        .copy-btn:hover {
            transform: scale(1.05);
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Location Tracker Link Generator</h1>
            <p class="text-gray-600">Generate a tracking link to get the real-time location of anyone who clicks it</p>
        </div>

        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden mb-8">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Create New Tracking Link</h2>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="link-name">
                        Link Name (Optional)
                    </label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                           id="link-name" type="text" placeholder="e.g. Customer Support Link">
                </div>
                <button id="generate-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline">
                    Generate Tracking Link
                </button>
            </div>
        </div>

        <div id="link-result" class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden mb-8 hidden">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Tracking Link</h2>
                <div class="flex items-center gap-2 mb-4">
                    <div class="link-box flex-grow p-3" id="tracking-link">
                        <!-- Link will appear here -->
                    </div>
                    <button id="copy-btn" class="copy-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">
                        Copy
                    </button>
                </div>
                <p class="text-gray-500 text-sm">Share this link with someone to track their location when they click it.</p>
            </div>
        </div>

        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden mb-8">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Live Location Tracking</h2>
                <div id="map" class="rounded-lg mb-4"></div>
                <div class="flex justify-between items-center">
                    <div>
                        <span id="status" class="text-sm font-medium pulse text-blue-600">Waiting for location data...</span>
                    </div>
                    <div id="location-data" class="text-sm text-gray-500 hidden">
                        <span id="coordinates"></span> | 
                        <span id="accuracy"></span> | 
                        <span id="timestamp"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">How It Works</h2>
                <div class="space-y-4">
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-100 text-blue-800 rounded-full p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800">Step 1: Generate Link</h3>
                            <p class="text-gray-600 text-sm">Create a unique tracking link that requests location when clicked.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-100 text-blue-800 rounded-full p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15l8-8m0 0l-8-8m8 8H4" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800">Step 2: Share the Link</h3>
                            <p class="text-gray-600 text-sm">Send the link via email, message, or any communication channel.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-100 text-blue-800 rounded-full p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800">Step 3: Get Location Data</h3>
                            <p class="text-gray-600 text-sm">When someone clicks the link (with location permissions granted), their location appears on your map.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize map
        const map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Store locations
        let locations = {};
        let marker = null;
        let currentLinkId = null;

        // Generate tracking link
        document.getElementById('generate-btn').addEventListener('click', function() {
            const linkName = document.getElementById('link-name').value;
            const uniqueId = generateId();
            currentLinkId = uniqueId;
            
            // Create tracking URL
            const trackingUrl = `${window.location.href.split('?')[0]}?track=${uniqueId}`;
            
            // Display the link
            const linkElement = document.getElementById('tracking-link');
            linkElement.textContent = trackingUrl;
            
            // Show the link result section
            document.getElementById('link-result').classList.remove('hidden');
            
            // Check for existing location data
            checkForLocationData(uniqueId);
        });

        // Copy button functionality
        document.getElementById('copy-btn').addEventListener('click', function() {
            const textToCopy = document.getElementById('tracking-link').textContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                const originalText = this.textContent;
                this.textContent = 'Copied!';
                this.classList.add('bg-green-100', 'text-green-800');
                setTimeout(() => {
                    this.textContent = originalText;
                    this.classList.remove('bg-green-100', 'text-green-800');
                }, 2000);
            });
        });

        // Generate random ID
        function generateId() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Check if we have location data in the URL
        function checkForLocationData(id) {
            const urlParams = new URLSearchParams(window.location.search);
            const trackId = urlParams.get('track');
            const lat = urlParams.get('lat');
            const lng = urlParams.get('lng');
            const acc = urlParams.get('acc');
            const time = urlParams.get('time');

            if (trackId === id && lat && lng) {
                // We have location data
                const location = {
                    lat: parseFloat(lat),
                    lng: parseFloat(lng),
                    accuracy: parseFloat(acc),
                    timestamp: new Date(parseInt(time))
                };
                
                updateMap(location);
                updateStatus(`Location captured: ${location.timestamp.toLocaleString()}`, false);
                
                document.getElementById('coordinates').textContent = `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}`;
                document.getElementById('accuracy').textContent = `Accuracy: ${location.accuracy} meters`;
                document.getElementById('timestamp').textContent = location.timestamp.toLocaleString();
                document.getElementById('location-data').classList.remove('hidden');
            } else if (trackId) {
                // This is a tracking link click - request location
                requestLocation(trackId);
            }
        }

        // Request location from user
        function requestLocation(trackId) {
            updateStatus('Requesting location access...', true);
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date(position.timestamp)
                        };
                        
                        // Send location data back
                        const url = `${window.location.pathname}?track=${trackId}&lat=${location.lat}&lng=${location.lng}&acc=${location.accuracy}&time=${location.timestamp.getTime()}`;
                        window.location.href = url;
                        
                        updateStatus('Location shared successfully', false);
                    },
                    (error) => {
                        let message = 'Error getting location: ';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                message += 'Permission denied.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message += 'Position unavailable.';
                                break;
                            case error.TIMEOUT:
                                message += 'Request timed out.';
                                break;
                            default:
                                message += 'Unknown error.';
                        }
                        updateStatus(message, false);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                updateStatus('Geolocation is not supported by this browser', false);
            }
        }

        // Update map with location
        function updateMap(location) {
            if (marker) {
                map.removeLayer(marker);
            }
            
            marker = L.marker([location.lat, location.lng]).addTo(map)
                .bindPopup(`<b>Location:</b> ${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}<br>
                          <b>Accuracy:</b> ~${Math.round(location.accuracy)} meters<br>
                          <b>Time:</b> ${location.timestamp.toLocaleString()}`);
            
            map.setView([location.lat, location.lng], 15);
            
            // Add accuracy circle
            L.circle([location.lat, location.lng], {
                color: 'blue',
                fillColor: '#3182ce',
                fillOpacity: 0.2,
                radius: location.accuracy
            }).addTo(map);
        }

        // Update status message
        function updateStatus(message, isPulsing) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            
            if (isPulsing) {
                statusElement.classList.add('pulse');
            } else {
                statusElement.classList.remove('pulse');
            }
        }

        // Check for any existing tracking params on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const trackId = urlParams.get('track');
            const lat = urlParams.get('lat');
            const lng = urlParams.get('lng');
            
            if (trackId && lat && lng) {
                // We have location data to display
                const location = {
                    lat: parseFloat(lat),
                    lng: parseFloat(lng),
                    accuracy: parseFloat(urlParams.get('acc')),
                    timestamp: new Date(parseInt(urlParams.get('time')))
                };
                
                updateMap(location);
                updateStatus(`Location captured: ${location.timestamp.toLocaleString()}`, false);
                
                document.getElementById('coordinates').textContent = `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}`;
                document.getElementById('accuracy').textContent = `Accuracy: ${location.accuracy} meters`;
                document.getElementById('timestamp').textContent = location.timestamp.toLocaleString();
                document.getElementById('location-data').classList.remove('hidden');
            } else if (trackId) {
                // This is a tracking link click - request location
                requestLocation(trackId);
            }
        });
    </script>
</body>
</html>

